<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>案例：视频物体检测测试 | 深度学习课程</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-katex/katex.min.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../day06/section7.html" />
    
    
    <link rel="prev" href="../day06/section5.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="7.6"
        data-chapter-title="案例：视频物体检测测试"
        data-filepath="day06/section6.md"
        data-basepath=".."
        data-revision="Mon Feb 25 2019 13:33:47 GMT+0800 (CST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="DeepLearning/index.html">
            
                
                    <a href="../DeepLearning/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        深度学习介绍
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="DeepLearning/section1.html">
            
                
                    <a href="../DeepLearning/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        深度学习与机器学习的区别
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="DeepLearning/section2.html">
            
                
                    <a href="../DeepLearning/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        深度学习的应用场景
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="DeepLearning/section3.html">
            
                
                    <a href="../DeepLearning/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        深度学习框架介绍
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="day01/index.html">
            
                
                    <a href="../day01/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        TensorFlow介绍
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="day01/section1.html">
            
                
                    <a href="../day01/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        TF数据流图
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="day01/section2.html">
            
                
                    <a href="../day01/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        图与TensorBoard
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="day01/section3.html">
            
                
                    <a href="../day01/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        会话
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="day01/section4.html">
            
                
                    <a href="../day01/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        张量
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="day01/section5.html">
            
                
                    <a href="../day01/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.</b>
                        
                        变量OP
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="day01/section6.html">
            
                
                    <a href="../day01/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.</b>
                        
                        案例：TensorFlow实现线性回归
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="day01/section7.html">
            
                
                    <a href="../day01/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.</b>
                        
                        逻辑回归原理与实现
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="day01/section8.html">
            
                
                    <a href="../day01/section8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.8.</b>
                        
                        总结
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="day01/section9.html">
            
                
                    <a href="../day01/section9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.9.</b>
                        
                        每日作业
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="day02/index.html">
            
                
                    <a href="../day02/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        神经网络与tf.keras
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="day02/section1.html">
            
                
                    <a href="../day02/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        图片基础与tf.keras介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="day02/section2.html">
            
                
                    <a href="../day02/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        神经网络基础
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="day02/section3.html">
            
                
                    <a href="../day02/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        神经网络原理
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="day02/section4.html">
            
                
                    <a href="../day02/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        案例：tf.keras进行时装分类
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="day02/section5.html">
            
                
                    <a href="../day02/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        深层神经网络与优化算法
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="day02/section6.html">
            
                
                    <a href="../day02/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        总结
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="day02/section7.html">
            
                
                    <a href="../day02/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        每日作业
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="day03/index.html">
            
                
                    <a href="../day03/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        卷积神经网络
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="day03/section1.html">
            
                
                    <a href="../day03/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        卷积神经网络简介
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="day03/section2.html">
            
                
                    <a href="../day03/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        卷积神经网络原理
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="day03/section3.html">
            
                
                    <a href="../day03/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        案例：CIFAR100类别分类
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="day03/section4.html">
            
                
                    <a href="../day03/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        正则化
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="day03/section5.html">
            
                
                    <a href="../day03/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        神经网络调优与BN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="day03/section6.html">
            
                
                    <a href="../day03/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        经典分类网络结构
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="day03/section7.html">
            
                
                    <a href="../day03/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        CNN网络实战技巧与迁移学习
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="day03/section8.html">
            
                
                    <a href="../day03/section8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.8.</b>
                        
                        案例：VGG迁移学习
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="day03/section9.html">
            
                
                    <a href="../day03/section9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.9.</b>
                        
                        总结
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.10" data-path="day03/section10.html">
            
                
                    <a href="../day03/section10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.10.</b>
                        
                        每日作业
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="day04/index.html">
            
                
                    <a href="../day04/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        商品物体检测项目介绍
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="day04/section1.html">
            
                
                    <a href="../day04/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        项目演示介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="day04/section2.html">
            
                
                    <a href="../day04/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        目标检测概述
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="day04/section3.html">
            
                
                    <a href="../day04/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        R-CNN与SPPNet
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="day04/section4.html">
            
                
                    <a href="../day04/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Fast R-CNN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="day04/section5.html">
            
                
                    <a href="../day04/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        Faster R-CNN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="day04/section6.html">
            
                
                    <a href="../day04/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        总结
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="day04/section7.html">
            
                
                    <a href="../day04/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.7.</b>
                        
                        每日作业
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6" data-path="day05/index.html">
            
                
                    <a href="../day05/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        YOLO与SSD
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="day05/section1.html">
            
                
                    <a href="../day05/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        YOLO算法原理
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="day05/section2.html">
            
                
                    <a href="../day05/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.2.</b>
                        
                        SSD算法原理
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="day05/section3.html">
            
                
                    <a href="../day05/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.3.</b>
                        
                        SSD网络接口介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="day05/section4.html">
            
                
                    <a href="../day05/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.4.</b>
                        
                        案例：SSD物体检测
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="day05/section5.html">
            
                
                    <a href="../day05/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.5.</b>
                        
                        总结
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="day05/section6.html">
            
                
                    <a href="../day05/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.6.</b>
                        
                        每日作业
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="day06/index.html">
            
                
                    <a href="../day06/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        商品检测数据集训练
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="day06/section1.html">
            
                
                    <a href="../day06/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        目标检测数据集与标记
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="day06/section2.html">
            
                
                    <a href="../day06/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        项目训练结构介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="day06/section3.html">
            
                
                    <a href="../day06/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        标注数据读取与存储
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="day06/section4.html">
            
                
                    <a href="../day06/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.4.</b>
                        
                        商品检测模型训练
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.5" data-path="day06/section5.html">
            
                
                    <a href="../day06/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.5.</b>
                        
                        Opencv-python介绍
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="7.6" data-path="day06/section6.html">
            
                
                    <a href="../day06/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.6.</b>
                        
                        案例：视频物体检测测试
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.7" data-path="day06/section7.html">
            
                
                    <a href="../day06/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.7.</b>
                        
                        总结
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.8" data-path="day06/section8.html">
            
                
                    <a href="../day06/section8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.8.</b>
                        
                        每日作业
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="day07/index.html">
            
                
                    <a href="../day07/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        模型导出与部署
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="day07/section1.html">
            
                
                    <a href="../day07/section1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Web与模型服务对接逻辑
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="day07/section2.html">
            
                
                    <a href="../day07/section2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        模型导出
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="day07/section3.html">
            
                
                    <a href="../day07/section3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        Docker部署环境使用介绍
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="day07/section4.html">
            
                
                    <a href="../day07/section4.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        TensorFlow Serving开启模型服务
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="day07/section5.html">
            
                
                    <a href="../day07/section5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        TensorFlow Client对接模型服务
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="day07/section6.html">
            
                
                    <a href="../day07/section6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.</b>
                        
                        Web Server开启
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.7" data-path="day07/section7.html">
            
                
                    <a href="../day07/section7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.7.</b>
                        
                        项目接口与百度机器人对接
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.8" data-path="day07/section8.html">
            
                
                    <a href="../day07/section8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.8.</b>
                        
                        总结
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.9" data-path="day07/section9.html">
            
                
                    <a href="../day07/section9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.9.</b>
                        
                        每日作业
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >深度学习课程</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="66-&#x6848;&#x4F8B;&#xFF1A;&#x89C6;&#x9891;&#x7269;&#x4F53;&#x68C0;&#x6D4B;&#x6D4B;&#x8BD5;">6.6 &#x6848;&#x4F8B;&#xFF1A;&#x89C6;&#x9891;&#x7269;&#x4F53;&#x68C0;&#x6D4B;&#x6D4B;&#x8BD5;</h1>
<h3 id="&#x5B66;&#x4E60;&#x76EE;&#x6807;">&#x5B66;&#x4E60;&#x76EE;&#x6807;</h3>
<ul>
<li>&#x76EE;&#x6807;<ul>
<li>&#x65E0;</li>
</ul>
</li>
<li>&#x5E94;&#x7528;<ul>
<li>&#x5E94;&#x7528;opencv+keras&#x5B8C;&#x6210;&#x89C6;&#x9891;&#x7269;&#x4F53;&#x68C0;&#x6D4B;&#x6D4B;&#x8BD5;&#x8FC7;&#x7A0B;</li>
</ul>
</li>
</ul>
<h2 id="661-&#x6848;&#x4F8B;&#x7ED3;&#x6784;&#x76EE;&#x5F55;">6.6.1 &#x6848;&#x4F8B;&#x7ED3;&#x6784;&#x76EE;&#x5F55;</h2>
<p><img src="../images/&#x89C6;&#x9891;&#x68C0;&#x6D4B;.png" alt=""></p>
<h2 id="662-&#x6848;&#x4F8B;&#x6548;&#x679C;&#x6F14;&#x793A;">6.6.2 &#x6848;&#x4F8B;&#x6548;&#x679C;&#x6F14;&#x793A;</h2>
<p><img src="../images/&#x89C6;&#x9891;&#x68C0;&#x6D4B;&#x6548;&#x679C;.png" alt=""></p>
<h2 id="663-&#x6B65;&#x9AA4;&#x5206;&#x6790;">6.6.3 &#x6B65;&#x9AA4;&#x5206;&#x6790;</h2>
<ul>
<li>&#x914D;&#x7F6E;&#x83B7;&#x53D6;&#x76F8;&#x5173;&#x9884;&#x6D4B;&#x6570;&#x636E;&#x7C7B;&#x522B;&#xFF0C;&#x7F51;&#x7EDC;&#x53C2;&#x6570;</li>
<li>&#x83B7;&#x53D6;&#x6444;&#x50CF;&#x5934;&#x89C6;&#x9891;</li>
<li>&#x83B7;&#x53D6;&#x6444;&#x50CF;&#x6BCF;&#x5E27;&#x6570;&#x636E;&#xFF0C;&#x8FDB;&#x884C;&#x683C;&#x5F0F;&#x5F62;&#x72B6;&#x5904;&#x7406;</li>
<li>&#x6A21;&#x578B;&#x9884;&#x6D4B;&#x3001;&#x7ED3;&#x679C;NMS&#x8FC7;&#x6EE4;</li>
<li>&#x753B;&#x56FE;&#xFF1A;&#x663E;&#x793A;&#x7269;&#x4F53;&#x4F4D;&#x7F6E;&#xFF0C;FPS&#x503C;&#xFF08;&#x6BCF;&#x79D2;&#x5E27;&#x6570;&#xFF09;</li>
</ul>
<h2 id="664-&#x4EE3;&#x7801;&#x5B9E;&#x73B0;">6.6.4 &#x4EE3;&#x7801;&#x5B9E;&#x73B0;</h2>
<p>&#x5BFC;&#x5165;&#x76F8;&#x5173;&#x5305;</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> keras
<span class="hljs-keyword">from</span> keras.applications.imagenet_utils <span class="hljs-keyword">import</span> preprocess_input
<span class="hljs-keyword">from</span> keras.backend.tensorflow_backend <span class="hljs-keyword">import</span> set_session
<span class="hljs-keyword">from</span> keras.models <span class="hljs-keyword">import</span> Model
<span class="hljs-keyword">from</span> keras.preprocessing <span class="hljs-keyword">import</span> image
<span class="hljs-keyword">import</span> pickle
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> shuffle
<span class="hljs-keyword">from</span> scipy.misc <span class="hljs-keyword">import</span> imread, imresize
<span class="hljs-keyword">from</span> timeit <span class="hljs-keyword">import</span> default_timer <span class="hljs-keyword">as</span> timer

<span class="hljs-keyword">from</span> utils.ssd_utils <span class="hljs-keyword">import</span> BBoxUtility
</code></pre>
<ul>
<li>1&#x3001;&#x914D;&#x7F6E;&#x83B7;&#x53D6;&#x76F8;&#x5173;&#x9884;&#x6D4B;&#x6570;&#x636E;&#x7C7B;&#x522B;&#xFF0C;&#x7F51;&#x7EDC;&#x53C2;&#x6570;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VideoTag</span><span class="hljs-params">(object)</span>:</span>
    <span class="hljs-string">&quot;&quot;&quot;
    &quot;&quot;&quot;</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, class_names, model, input_shape)</span>:</span>
        <span class="hljs-comment"># &#x83B7;&#x53D6;</span>
        self.class_names = class_names
        self.num_classes = len(class_names)
        self.model = model
        self.input_shape = input_shape
        self.bbox_util = BBoxUtility(self.num_classes)
</code></pre>
<ul>
<li>2&#x3001;&#x83B7;&#x53D6;&#x6444;&#x50CF;&#x5934;&#x89C6;&#x9891;</li>
</ul>
<pre><code class="lang-python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self, video_path=<span class="hljs-number">0</span>, conf_thresh=<span class="hljs-number">0.6</span>)</span>:</span>
        <span class="hljs-string">&quot;&quot;&quot;&#x8FD0;&#x884C;&#x6D4B;&#x8BD5;
        &quot;&quot;&quot;</span>

        vid = cv2.VideoCapture(video_path)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> vid.isOpened():
            <span class="hljs-keyword">raise</span> IOError((<span class="hljs-string">&quot;&#x627E;&#x4E0D;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x89C6;&#x9891;&#x6216;&#x8005;&#x6444;&#x50CF;&#x5934;&quot;</span>))
</code></pre>
<ul>
<li>3&#x3001;&#x83B7;&#x53D6;&#x6444;&#x50CF;&#x6BCF;&#x5E27;&#x6570;&#x636E;&#xFF0C;&#x8FDB;&#x884C;&#x683C;&#x5F0F;&#x5F62;&#x72B6;&#x5904;&#x7406;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-comment"># &#x83B7;&#x53D6;&#x89C6;&#x9891;&#x6216;&#x8005;&#x6444;&#x50CF;&#x5934;&#x5185;&#x5BB9;</span>
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">True</span>:
            retval, orig_image = cap.read()
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> retval:
                print(<span class="hljs-string">&quot;&#x89C6;&#x9891;&#x68C0;&#x6D4B;&#x7ED3;&#x675F;!&quot;</span>)
                <span class="hljs-keyword">return</span>
            source_image = np.copy(orig_image)

            <span class="hljs-comment"># &#x8FDB;&#x884C;&#x8F93;&#x5165;&#x6BCF;&#x5E27;&#x6570;&#x636E;&#x5F62;&#x72B6;&#x4FEE;&#x6539;&#x4EE5;&#x53CA;&#x56FE;&#x7247;&#x7684;&#x683C;&#x5F0F;&#x4FEE;&#x6539;BGR---&gt;RGB</span>
            im_size = (self.input_shape[<span class="hljs-number">0</span>], self.input_shape[<span class="hljs-number">1</span>])
            resized = cv2.resize(orig_image, im_size)
            rgb = cv2.cvtColor(resized, cv2.COLOR_BGR2RGB)

            <span class="hljs-comment"># &#x5C06;&#x6570;&#x636E;&#x8F6C;&#x6362;&#x6210;&#x539F;&#x59CB;&#x9700;&#x8981;&#x753B;&#x51FA;&#x7684;&#x56FE;&#x7247;</span>
            to_draw = cv2.resize(resized, (int(source_image.shape[<span class="hljs-number">1</span>]), int(source_image.shape[<span class="hljs-number">0</span>])))
</code></pre>
<ul>
<li>4&#x3001;&#x6A21;&#x578B;&#x9884;&#x6D4B;&#x3001;&#x7ED3;&#x679C;NMS&#x8FC7;&#x6EE4;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-comment"># &#x4F7F;&#x7528;&#x6A21;&#x578B;&#x8FDB;&#x884C;&#x6BCF;&#x5E27;&#x6570;&#x636E;&#x9884;&#x6D4B;</span>
inputs = [image.img_to_array(rgb)]
tmp_inp = np.array(inputs)
x = preprocess_input(tmp_inp)

y = self.model.predict(x)

<span class="hljs-comment"># &#x5BF9;&#x9884;&#x6D4B;&#x7ED3;&#x679C;&#x8FDB;&#x884C;NMS&#x8FC7;&#x6EE4;</span>
results = self.bbox_util.detection_out(y)
</code></pre>
<ul>
<li>5&#x3001;&#x753B;&#x56FE;&#x663E;&#x793A;<ul>
<li>&#x753B;&#x51FA;&#x7269;&#x4F53;&#x4F4D;&#x7F6E;&#xFF0C;&#x7ED9;&#x5B9A;&#x56FA;&#x5B9A;&#x9608;&#x503C;</li>
</ul>
</li>
</ul>
<pre><code class="lang-python">            <span class="hljs-comment"># &#x753B;&#x56FE;&#x663E;&#x793A;</span>
            <span class="hljs-keyword">if</span> len(results) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> len(results[<span class="hljs-number">0</span>]) &gt; <span class="hljs-number">0</span>:
                <span class="hljs-comment"># &#x83B7;&#x53D6;&#x6BCF;&#x4E2A;&#x6846;&#x7684;&#x4F4D;&#x7F6E;&#x4EE5;&#x53CA;&#x7C7B;&#x522B;&#x6982;&#x7387;</span>
                det_label = results[<span class="hljs-number">0</span>][:, <span class="hljs-number">0</span>]
                det_conf = results[<span class="hljs-number">0</span>][:, <span class="hljs-number">1</span>]
                det_xmin = results[<span class="hljs-number">0</span>][:, <span class="hljs-number">2</span>]
                det_ymin = results[<span class="hljs-number">0</span>][:, <span class="hljs-number">3</span>]
                det_xmax = results[<span class="hljs-number">0</span>][:, <span class="hljs-number">4</span>]
                det_ymax = results[<span class="hljs-number">0</span>][:, <span class="hljs-number">5</span>]
                <span class="hljs-comment"># &#x8FC7;&#x6EE4;&#x6982;&#x7387;&#x5C0F;&#x7684;</span>
                top_indices = [i <span class="hljs-keyword">for</span> i, conf <span class="hljs-keyword">in</span> enumerate(det_conf) <span class="hljs-keyword">if</span> conf &gt;= conf_thresh]

                top_conf = det_conf[top_indices]
                top_label_indices = det_label[top_indices].tolist()
                top_xmin = det_xmin[top_indices]
                top_ymin = det_ymin[top_indices]
                top_xmax = det_xmax[top_indices]
                top_ymax = det_ymax[top_indices]

                <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(top_conf.shape[<span class="hljs-number">0</span>]):
                    xmin = int(round(top_xmin[i] * to_draw.shape[<span class="hljs-number">1</span>]))
                    ymin = int(round(top_ymin[i] * to_draw.shape[<span class="hljs-number">0</span>]))
                    xmax = int(round(top_xmax[i] * to_draw.shape[<span class="hljs-number">1</span>]))
                    ymax = int(round(top_ymax[i] * to_draw.shape[<span class="hljs-number">0</span>]))

                    <span class="hljs-comment"># &#x5BF9;&#x4E8E;&#x56DB;&#x4E2A;&#x5750;&#x6807;&#x7269;&#x4F53;&#x6846;&#x8FDB;&#x884C;&#x753B;&#x56FE;&#x663E;&#x793A;</span>
                    class_num = int(top_label_indices[i])
                    cv2.rectangle(to_draw, (xmin, ymin), (xmax, ymax),
                                  self.class_colors[class_num], <span class="hljs-number">2</span>)
                    text = self.class_names[class_num] + <span class="hljs-string">&quot; &quot;</span> + (<span class="hljs-string">&apos;%.2f&apos;</span> % top_conf[i])

                    <span class="hljs-comment"># &#x6587;&#x672C;&#x6846;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#x663E;&#x793A;</span>
                    text_top = (xmin, ymin - <span class="hljs-number">10</span>)
                    text_bot = (xmin + <span class="hljs-number">80</span>, ymin + <span class="hljs-number">5</span>)
                    text_pos = (xmin + <span class="hljs-number">5</span>, ymin)
                    cv2.rectangle(to_draw, text_top, text_bot, self.class_colors[class_num], -<span class="hljs-number">1</span>)
                    cv2.putText(to_draw, text, text_pos, cv2.FONT_HERSHEY_SIMPLEX, <span class="hljs-number">0.35</span>, (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1</span>)
</code></pre>
<ul>
<li>&#x663E;&#x793A;FPS&#x53C2;&#x6570;</li>
</ul>
<pre><code class="lang-python">            <span class="hljs-comment"># &#x8BA1;&#x7B97; FPS&#x663E;&#x793A;</span>
            fps = <span class="hljs-string">&quot;FPS: &quot;</span> + str(cap.get(cv2.CAP_PROP_FPS))

            <span class="hljs-comment"># &#x753B;&#x51FA;FPS</span>
            cv2.rectangle(to_draw, (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), (<span class="hljs-number">50</span>, <span class="hljs-number">17</span>), (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>), -<span class="hljs-number">1</span>)
            cv2.putText(to_draw, fps, (<span class="hljs-number">3</span>, <span class="hljs-number">10</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="hljs-number">0.35</span>, (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">1</span>)
</code></pre>
<ul>
<li>&#x663E;&#x793A;&#x56FE;&#x7247;</li>
</ul>
<pre><code class="lang-python">            <span class="hljs-comment"># &#x663E;&#x793A;&#x56FE;&#x7247;</span>
            cv2.imshow(<span class="hljs-string">&quot;SSD result&quot;</span>, to_draw)
            cv2.waitKey(<span class="hljs-number">1</span>)
 <span class="hljs-comment"># &#x91CA;&#x653E;capture&#x8D44;&#x6E90;</span>
cap.release()
cv2.destroyAllWindows()
</code></pre>
<h2 id="664-&#x8C03;&#x7528;&#x89C6;&#x9891;&#x9884;&#x6D4B;">6.6.4 &#x8C03;&#x7528;&#x89C6;&#x9891;&#x9884;&#x6D4B;</h2>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> keras
<span class="hljs-keyword">from</span> utils.tag_video <span class="hljs-keyword">import</span> VideoTag
<span class="hljs-keyword">from</span> nets.ssd_net <span class="hljs-keyword">import</span> SSD300


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span>

    input_shape = (<span class="hljs-number">300</span>, <span class="hljs-number">300</span>, <span class="hljs-number">3</span>)

    <span class="hljs-comment"># &#x6570;&#x636E;&#x96C6;&#x7684;&#x914D;&#x7F6E;</span>
    class_names = [<span class="hljs-string">&quot;background&quot;</span>, <span class="hljs-string">&quot;aeroplane&quot;</span>, <span class="hljs-string">&quot;bicycle&quot;</span>, <span class="hljs-string">&quot;bird&quot;</span>, <span class="hljs-string">&quot;boat&quot;</span>, <span class="hljs-string">&quot;bottle&quot;</span>, <span class="hljs-string">&quot;bus&quot;</span>, <span class="hljs-string">&quot;car&quot;</span>, <span class="hljs-string">&quot;cat&quot;</span>, <span class="hljs-string">&quot;chair&quot;</span>, <span class="hljs-string">&quot;cow&quot;</span>,
                   <span class="hljs-string">&quot;diningtable&quot;</span>, <span class="hljs-string">&quot;dog&quot;</span>, <span class="hljs-string">&quot;horse&quot;</span>, <span class="hljs-string">&quot;motorbike&quot;</span>, <span class="hljs-string">&quot;person&quot;</span>, <span class="hljs-string">&quot;pottedplant&quot;</span>, <span class="hljs-string">&quot;sheep&quot;</span>, <span class="hljs-string">&quot;sofa&quot;</span>, <span class="hljs-string">&quot;train&quot;</span>,
                   <span class="hljs-string">&quot;tvmonitor&quot;</span>]

    NUM_CLASSES = len(class_names)

    model = SSD300(input_shape, num_classes=NUM_CLASSES)

    <span class="hljs-comment"># &#x52A0;&#x8F7D;&#x6A21;&#x578B;</span>
    model.load_weights(<span class="hljs-string">&apos;./ckpt/pre_trained/weights_SSD300.hdf5&apos;</span>)

    vid_test = VideoTag(class_names, model, input_shape)

    vid_test.run(<span class="hljs-number">0</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&apos;__main__&apos;</span>:
    main()
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../day06/section5.html" class="navigation navigation-prev " aria-label="Previous page: Opencv-python介绍"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../day06/section7.html" class="navigation navigation-next " aria-label="Next page: 总结"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"katex":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
